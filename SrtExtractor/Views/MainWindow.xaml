    <Window x:Class="SrtExtractor.Views.MainWindow"
            xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
            xmlns:local="clr-namespace:SrtExtractor.Views"
            xmlns:converters="clr-namespace:SrtExtractor.Converters"
            mc:Ignorable="d"
            Title="SrtExtractor - MKV/MP4 Subtitle Extractor"
            Height="850" Width="1000"
            MinHeight="750" MinWidth="900"
            Background="White">
    
    <Window.Resources>
        <converters:BoolToStatusConverter x:Key="BoolToStatusConverter"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <Style TargetType="Button">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="MinWidth" Value="80"/>
        </Style>
        
        <Style TargetType="GroupBox">
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Padding" Value="8"/>
        </Style>
        
        <Style TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <!-- DataGrid Selection Style -->
        <Style TargetType="DataGridRow">
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#FF0078D4"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FFE3F2FD"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- File Selection Row -->
        <GroupBox Header="Video File" Grid.Row="0">
            <StackPanel Orientation="Horizontal">
                <Button Content="Pick Video..." 
                        Command="{Binding PickMkvCommand}"
                        IsEnabled="{Binding State.IsBusy, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                <TextBox Text="{Binding State.MkvPath}" 
                         IsReadOnly="True" 
                         Margin="4,0"
                         VerticalAlignment="Center"
                         MinWidth="300"/>
            </StackPanel>
        </GroupBox>

        <!-- Tool Status Panel -->
        <GroupBox Header="Tool Status" Grid.Row="1">
            <StackPanel>
                <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- MKVToolNix Status -->
                <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Margin="0,4">
                    <TextBlock Text="MKVToolNix:" FontWeight="Bold" Width="120"/>
                    <TextBlock Text="{Binding State.MkvToolNixStatus.IsInstalled, Converter={StaticResource BoolToStatusConverter}}" 
                               Margin="4,0"/>
                    <Button Content="Install via winget" 
                            Command="{Binding InstallMkvToolNixCommand}"
                            Visibility="{Binding State.MkvToolNixStatus.IsInstalled, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                            Background="LightGreen"/>
                    <Button Content="Browse..." 
                            Command="{Binding BrowseMkvToolNixCommand}"/>
                </StackPanel>

                <!-- Subtitle Edit Status -->
                <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Margin="0,4">
                    <TextBlock Text="Subtitle Edit CLI:" FontWeight="Bold" Width="120"/>
                    <TextBlock Text="{Binding State.SubtitleEditStatus.IsInstalled, Converter={StaticResource BoolToStatusConverter}}" 
                               Margin="4,0"/>
                    <TextBlock Text="(Auto-built)" 
                               FontStyle="Italic" 
                               Foreground="Gray" 
                               Margin="8,0"/>
                </StackPanel>

                <!-- FFmpeg Status -->
                <StackPanel Grid.Row="2" Grid.Column="0" Orientation="Horizontal" Margin="0,4">
                    <TextBlock Text="FFmpeg:" FontWeight="Bold" Width="120"/>
                    <TextBlock Text="{Binding State.FfmpegStatus.IsInstalled, Converter={StaticResource BoolToStatusConverter}}" 
                               Margin="4,0"/>
                    <TextBlock Text="(Auto-downloaded)" 
                               FontStyle="Italic" 
                               Foreground="Gray" 
                               Margin="8,0"/>
                </StackPanel>

                <!-- Tool Paths Display -->
                <StackPanel Grid.Row="0" Grid.Column="1" Margin="20,4,0,4">
                    <TextBlock Text="{Binding State.MkvToolNixStatus.Path, StringFormat='Path: {0}'}" 
                               FontSize="10" 
                               Foreground="Gray"
                               TextWrapping="Wrap"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="1" Margin="20,4,0,4">
                    <TextBlock Text="{Binding State.SubtitleEditStatus.Path, StringFormat='Path: {0}'}" 
                               FontSize="10" 
                               Foreground="Gray"
                               TextWrapping="Wrap"/>
                </StackPanel>

                <StackPanel Grid.Row="2" Grid.Column="1" Margin="20,4,0,4">
                    <TextBlock Text="{Binding State.FfmpegStatus.Path, StringFormat='Path: {0}'}" 
                               FontSize="10" 
                               Foreground="Gray"
                               TextWrapping="Wrap"/>
                </StackPanel>
                </Grid>
                
                <!-- Re-detect Tools Button -->
                <Button Content="🔄 Re-detect Tools" 
                        Command="{Binding ReDetectToolsCommand}"
                        Background="LightBlue" 
                        Margin="0,8,0,0"
                        Padding="8,4"
                        HorizontalAlignment="Center"/>
                
                <!-- Correct SRT Button -->
                <Button Content="🔧 Correct SRT File" 
                        Command="{Binding CorrectSrtCommand}"
                        Background="LightGreen" 
                        Margin="0,4,0,0"
                        Padding="8,4"
                        HorizontalAlignment="Center"/>
            </StackPanel>
        </GroupBox>

        <!-- Settings Row -->
        <GroupBox Header="Settings" Grid.Row="2">
            <StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,5">
                    <RadioButton Content="Prefer forced subtitles" 
                                 IsChecked="{Binding State.PreferForced}"
                                 GroupName="SubtitlePreference"
                                 VerticalAlignment="Center"
                                 Margin="0,0,20,0"/>
                    <RadioButton Content="Prefer CC (Closed Captions)" 
                                 IsChecked="{Binding State.PreferClosedCaptions}"
                                 GroupName="SubtitlePreference"
                                 VerticalAlignment="Center"
                                 Margin="0,0,20,0"/>
                </StackPanel>
                
                <StackPanel Orientation="Horizontal" Margin="0,10">
                    <TextBlock Text="OCR Language:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <ComboBox SelectedItem="{Binding State.OcrLanguage}" 
                              ItemsSource="{Binding State.AvailableLanguages}"
                              Width="80"
                              Margin="0,0,20,0"/>
                    <TextBlock Text="File Pattern:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBox Text="{Binding State.FileNamePattern}" 
                             Width="200"
                             ToolTip="Pattern: {basename}.{lang}{forced}{cc}.srt"/>
                </StackPanel>
                
            </StackPanel>
        </GroupBox>

        <!-- Action Buttons -->
        <GroupBox Header="Actions" Grid.Row="3">
            <StackPanel Orientation="Horizontal">
                <Button Content="Probe Tracks" 
                        Command="{Binding ProbeCommand}"
                        IsEnabled="{Binding State.CanProbe}"
                        Background="LightBlue"/>
                <Button Content="Extract Selected → SRT" 
                        Command="{Binding ExtractCommand}"
                        IsEnabled="{Binding State.CanExtract}"
                        Background="LightCoral"/>
                <Button Content="Cancel" 
                        Command="{Binding CancelCommand}"
                        IsEnabled="{Binding State.IsProcessing}"
                        Background="Orange"
                        Visibility="{Binding State.IsProcessing, Converter={StaticResource BoolToVisibilityConverter}}"/>
                <Button Content="Clear Log" 
                        Click="ClearLog_Click"
                        Background="LightGray"/>
                <Button Content="About" 
                        Click="About_Click"
                        Background="LightGreen"
                        Margin="10,0,0,0"/>
            </StackPanel>
        </GroupBox>

        <!-- Processing Indicator -->
        <GroupBox Header="Processing" Grid.Row="4" Visibility="{Binding State.IsProcessing, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" 
                            Width="20" 
                            Height="20" 
                            Margin="0,0,10,0"/>
                <TextBlock Text="{Binding State.ProcessingMessage}" 
                           FontWeight="Bold" 
                           VerticalAlignment="Center"/>
            </StackPanel>
        </GroupBox>

        <!-- Track List -->
        <GroupBox Header="Subtitle Tracks" Grid.Row="5">
            <DataGrid ItemsSource="{Binding State.Tracks}" 
                      SelectedItem="{Binding State.SelectedTrack}"
                      AutoGenerateColumns="False" 
                      IsReadOnly="True"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      SelectionMode="Single">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" 
                                        Binding="{Binding Id}" 
                                        Width="40"/>
                    <DataGridTextColumn Header="Codec" 
                                        Binding="{Binding Codec}" 
                                        Width="120"/>
                    <DataGridTextColumn Header="Language" 
                                        Binding="{Binding Language}" 
                                        Width="80"/>
                    <DataGridTextColumn Header="Type" 
                                        Binding="{Binding TrackType}" 
                                        Width="80"/>
                    <DataGridCheckBoxColumn Header="Forced" 
                                            Binding="{Binding Forced}" 
                                            Width="60"/>
                    <DataGridTextColumn Header="Recommended" 
                                        Binding="{Binding IsRecommended}" 
                                        Width="100">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="⭐ Recommended"/>
                                <Setter Property="Foreground" Value="Green"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsRecommended}" Value="False">
                                        <Setter Property="Text" Value=""/>
                                        <Setter Property="Foreground" Value="Transparent"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Bitrate" 
                                        Binding="{Binding Bitrate, StringFormat='{}{0:N0} bps'}" 
                                        Width="100"/>
                    <DataGridTextColumn Header="Frames" 
                                        Binding="{Binding FrameCount}" 
                                        Width="70"/>
                    <DataGridTextColumn Header="Duration" 
                                        Binding="{Binding Duration, Converter={StaticResource DurationConverter}}" 
                                        Width="100"/>
                    <DataGridTextColumn Header="Name" 
                                        Binding="{Binding Name}" 
                                        Width="*"/>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <!-- Log Display -->
        <GroupBox Header="Log" Grid.Row="6">
            <ScrollViewer Height="150" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                <TextBox Text="{Binding State.LogText}" 
                         IsReadOnly="True" 
                         TextWrapping="Wrap" 
                         AcceptsReturn="True"
                         Background="Black" 
                         Foreground="LightGreen"
                         FontFamily="Consolas"
                         FontSize="11"/>
            </ScrollViewer>
        </GroupBox>
    </Grid>
</Window>
